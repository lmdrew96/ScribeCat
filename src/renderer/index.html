<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScribeCat</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <!-- Empty space for native window controls -->
            </div>
            <div class="header-center">
                <div class="logo-container">
                    <img src="../../assets/images/nugget-logo.PNG" alt="ScribeCat" class="logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div class="logo-text" style="display: none;">ScribeCat üìùüê±</div>
                    <h1 class="app-title">ScribeCat</h1>
                </div>
            </div>
            <div class="header-right">
                <!-- Mode Toggle -->
                <div class="mode-toggle" id="mode-toggle">
                    <button class="mode-btn active" id="capture-mode-btn" 
                            data-testid="capture-mode-btn"
                            title="Capture Mode - Record lectures and take notes">
                        <span class="mode-emoji">üéôÔ∏è</span>
                    </button>
                    <button class="mode-btn" id="study-mode-btn" 
                            data-testid="study-mode-btn"
                            title="Study Mode - Review recordings and notes">
                        <span class="mode-emoji">üìñ</span>
                    </button>
                </div>
                
                <!-- Course Selector in Header -->
                <div class="header-course-selector">
                    <select id="header-course-select" class="input-field course-selector-header" data-testid="course-selector">
                        <option value="">Choose a course...</option>
                        <option value="other">Other</option>
                    </select>
                    <div id="course-selection-error" class="course-selection-error" style="display: none;">
                        <span class="error-message">Please select a course before recording</span>
                    </div>
                </div>
                
                <div class="clock-section">
                    <div class="clock" id="clock">
                        <div class="time">12:00 PM</div>
                        <div class="date">Monday, Jan 1</div>
                    </div>
                </div>
            </div>
        </header>



        <!-- Error Notification Banner -->
        <div class="error-notification" id="error-notification" style="display: none;">
            <div class="notification-content">
                <div class="notification-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </div>
                <div class="notification-message">
                    <span id="error-notification-text">ScribeCat encountered an issue that may affect functionality</span>
                </div>
                <div class="notification-actions">
                    <button id="dismiss-error" class="btn-notification dismiss" title="Dismiss this notification">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                    <button id="report-error-bug" class="btn-notification primary">Report Bug</button>
                </div>
            </div>
        </div>

        <!-- Hamburger Menu Button -->
        <button class="hamburger-menu-btn" id="hamburger-menu-btn" data-testid="hamburger-menu-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>

        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- Sidebar Panel -->
        <aside class="sidebar-panel" id="sidebar-panel">
            <div class="sidebar-header">
                <h2>Settings</h2>
                <button class="sidebar-close-btn" id="sidebar-close-btn" title="Close sidebar">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="sidebar-content">
                <!-- Theme Settings Section -->
                <div class="sidebar-section">
                    <div class="section-header" data-section="themes">
                        <h3>Themes</h3>
                        <svg class="section-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"></polyline>
                        </svg>
                    </div>
                    <div class="section-content" id="themes-content">
                        <div class="theme-grid-container">
                            <div class="theme-grid" id="theme-grid">
                                <!-- Theme options will be generated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Canvas Settings Section -->
                <div class="sidebar-section">
                    <div class="section-header" data-section="canvas">
                        <h3>Canvas Integration</h3>
                        <svg class="section-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"></polyline>
                        </svg>
                    </div>
                    <div class="section-content" id="canvas-content">
                        <div class="canvas-settings">
                            <input type="text" id="canvas-url" placeholder="Canvas URL" class="input-field">
                            <div class="course-selection">
                                <select id="course-select" class="input-field">
                                    <option value="">Select Course</option>
                                    <option value="other">Other (Manual Entry)</option>
                                </select>
                                <div id="manual-course-fields" class="manual-course-fields" style="display: none;">
                                    <input type="text" id="course-number" placeholder="Course Number" class="input-field">
                                    <input type="text" id="course-title" placeholder="Course Title" class="input-field">
                                </div>
                            </div>
                            <div class="canvas-buttons">
                                <button id="save-canvas" class="btn btn-small">Save</button>
                                <button id="manage-courses" class="btn btn-small">Manage Courses</button>
                                <button id="import-from-extension" class="btn btn-small btn-primary">Import from Extension</button>
                            </div>
                            
                            <!-- Browser Extension Installation -->
                            <div class="extension-installation">
                                <h4>Install Browser Extension</h4>
                                <p>Install the ScribeCat browser extension to automatically collect course information from Canvas:</p>
                                <div class="extension-buttons">
                                    <button id="install-chrome" class="btn btn-small extension-btn" data-browser="chrome">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                        </svg>
                                        Chrome
                                    </button>
                                    <button id="install-firefox" class="btn btn-small extension-btn" data-browser="firefox">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                        </svg>
                                        Firefox
                                    </button>
                                    <button id="install-safari" class="btn btn-small extension-btn" data-browser="safari">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                        </svg>
                                        Safari
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Audio Settings Section -->
                <div class="sidebar-section">
                    <div class="section-header" data-section="audio">
                        <h3>Audio Settings</h3>
                        <svg class="section-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"></polyline>
                        </svg>
                    </div>
                    <div class="section-content" id="audio-content">
                        <div class="audio-settings">
                            <div class="audio-destination">
                                <label>Audio File Destination:</label>
                                <div class="radio-group">
                                    <label>
                                        <input type="radio" name="audio-destination" value="local" id="audio-dest-local">
                                        <span>Download to Local Folder</span>
                                    </label>
                                    <label>
                                        <input type="radio" name="audio-destination" value="drive" id="audio-dest-drive">
                                        <span>Upload to Google Drive</span>
                                    </label>
                                </div>
                            </div>
                            <div class="local-folder-settings">
                                <label>Local Audio Folder:</label>
                                <input type="text" id="local-audio-folder" placeholder="Select local folder for audio files" class="input-field" readonly>
                                <button id="select-local-audio-folder" class="btn btn-small">Select Folder</button>
                            </div>
                            <label class="checkbox-label">
                                <input type="checkbox" id="vocal-isolation">
                                <span>Vocal Isolation</span>
                            </label>
                            <select id="microphone-select" class="input-field">
                                <option value="">Select Microphone</option>
                            </select>
                            <label for="transcription-backend">Transcription Backend:</label>
                            <select id="transcription-backend" class="input-field">
                                <option value="vosk">Vosk (Offline)</option>
                                <option value="whisper">Whisper (Optional)</option>
                            </select>
                            
                            <!-- Developer Settings -->
                            <div class="developer-settings">
                                <h4>Developer Settings</h4>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="simulation-toggle">
                                    <span>Simulation Mode (for testing)</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Google Drive Settings Section -->
                <div class="sidebar-section">
                    <div class="section-header" data-section="drive">
                        <h3>Google Drive</h3>
                        <svg class="section-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"></polyline>
                        </svg>
                    </div>
                    <div class="section-content" id="drive-content">
                        <div class="drive-settings">
                            <div class="drive-setup-info">
                                <p>Need Google Drive for Desktop? <a href="#" id="drive-download-link">Download here</a></p>
                            </div>
                            <div class="drive-folder-setting">
                                <label>Notes Folder:</label>
                                <input type="text" id="notes-drive-folder" placeholder="Select Drive folder for notes" class="input-field" readonly>
                                <button id="select-notes-drive-folder" class="btn btn-small">Select Folder</button>
                            </div>
                            <div class="drive-folder-setting">
                                <label>Transcription Folder:</label>
                                <input type="text" id="transcription-drive-folder" placeholder="Select Drive folder for transcriptions" class="input-field" readonly>
                                <button id="select-transcription-drive-folder" class="btn btn-small">Select Folder</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Subscription Section -->
                <div class="sidebar-section">
                    <div class="section-header" data-section="subscription">
                        <h3>Subscription</h3>
                        <svg class="section-toggle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"></polyline>
                        </svg>
                    </div>
                    <div class="section-content" id="subscription-content">
                        <div class="subscription-info">
                            <div class="current-tier">
                                <div class="tier-badge" id="tier-badge">Free</div>
                                <div class="tier-description" id="tier-description">Limited features</div>
                            </div>
                            
                            <div class="usage-stats" id="usage-stats">
                                <div class="usage-item">
                                    <span class="usage-label">AI Summaries this session:</span>
                                    <span class="usage-value" id="session-summaries">0/1</span>
                                </div>
                                <div class="usage-item" id="token-usage" style="display: none;">
                                    <span class="usage-label">AskAI tokens today:</span>
                                    <span class="usage-value" id="daily-tokens">0/10,000</span>
                                </div>
                            </div>
                            
                            <div class="subscription-actions">
                                <button class="btn btn-primary" id="upgrade-subscription">Upgrade to Plus ($12/month)</button>
                                <button class="btn btn-secondary" id="view-premium-unlocks">Premium Unlocks Store</button>
                                <button class="btn btn-secondary" id="sign-out-btn" style="display: none;">Sign Out</button>
                                <button class="btn btn-primary" id="sign-in-btn" style="display: none;">Sign In</button>
                            </div>
                            
                            <div class="claude-api-settings">
                                <h4>Claude API Key</h4>
                                <div class="api-key-input-group">
                                    <input type="password" id="claude-key" placeholder="Enter your Claude API key" class="input-field">
                                    <button id="save-claude-key" class="btn btn-small">Save Key</button>
                                </div>
                                <p class="api-key-note">Your API key is stored securely and only used for AI features.</p>
                            </div>
                            
                            <div class="features-list">
                                <h4>Your Plan Includes:</h4>
                                <ul class="feature-list" id="current-features">
                                    <li>‚úÖ Audio transcription</li>
                                    <li>‚úÖ Note taking & editing</li>
                                    <li>‚úÖ 1 AI summary per session</li>
                                    <li>‚ùå AskAI chat</li>
                                    <li>‚ùå AI Autopolish</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content" id="main-content">
            <!-- Capture Mode - Existing recording interface -->
            <div class="capture-mode" id="capture-mode" data-testid="capture-mode">
                <!-- Recording Controls -->
                <div class="recording-controls">
                    <button id="record-btn" class="btn btn-primary record-btn" data-testid="record-btn" title="Start recording audio and transcription (Ctrl+R / ‚åòR)">
                        <svg class="record-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                        Start Recording
                    </button>
                    <div class="recording-time" id="recording-time">00:00</div>
                    
                    <!-- VU Meter -->
                    <div class="vu-meter" id="vu-meter" style="display: none;">
                        <label>Audio Level:</label>
                        <div class="vu-bar-container">
                            <div class="vu-bar" id="vu-bar"></div>
                        </div>
                    </div>
                    
                    <button id="pause-btn" class="btn" disabled title="Pause current recording (Ctrl+P / ‚åòP)">Pause</button>
                    <button id="resume-btn" class="btn" disabled title="Resume paused recording (Ctrl+P / ‚åòP)">Resume</button>
                    <button id="stop-btn" class="btn btn-danger" disabled title="Stop recording and enable save">Stop</button>
                    <button id="save-btn" class="btn btn-success" data-testid="save-btn" disabled title="Save recording, notes, and transcription (Ctrl+S / ‚åòS)">Save</button>
                </div>


                <!-- Content Container -->
                <div class="content-container">
                    <!-- Notes Editor -->
                    <div class="editor-section">
                        <div class="editor-header">
                            <h2>Notes</h2>
                        </div>
                        <div class="formatting-toolbar">
                            <!-- Text Style Section -->
                            <div class="toolbar-section">
                                <select id="font-family" class="toolbar-select" title="Font">
                                    <optgroup label="Traditional Serif">
                                        <option value="Times New Roman">Times New Roman</option>
                                        <option value="Georgia">Georgia</option>
                                        <option value="Garamond">Garamond</option>
                                        <option value="Book Antiqua">Book Antiqua</option>
                                        <option value="Palatino">Palatino</option>
                                    </optgroup>
                                    <optgroup label="Non-Traditional Serif">
                                        <option value="Playfair Display">Playfair Display</option>
                                        <option value="Crimson Text">Crimson Text</option>
                                        <option value="Libre Baskerville">Libre Baskerville</option>
                                        <option value="Merriweather">Merriweather</option>
                                        <option value="Vollkorn">Vollkorn</option>
                                    </optgroup>
                                    <optgroup label="Traditional Sans Serif">
                                        <option value="Arial">Arial</option>
                                        <option value="Helvetica">Helvetica</option>
                                        <option value="Calibri">Calibri</option>
                                        <option value="Tahoma">Tahoma</option>
                                        <option value="Verdana">Verdana</option>
                                        <option value="Geneva">Geneva</option>
                                        <option value="Lucida Sans">Lucida Sans</option>
                                        <option value="Trebuchet MS">Trebuchet MS</option>
                                        <option value="Century Gothic">Century Gothic</option>
                                        <option value="Franklin Gothic">Franklin Gothic</option>
                                    </optgroup>
                                    <optgroup label="Non-Traditional Sans Serif">
                                        <option value="Inter" selected>Inter</option>
                                        <option value="Roboto">Roboto</option>
                                        <option value="Open Sans">Open Sans</option>
                                        <option value="Lato">Lato</option>
                                        <option value="Montserrat">Montserrat</option>
                                        <option value="Source Sans Pro">Source Sans Pro</option>
                                        <option value="Nunito">Nunito</option>
                                        <option value="Poppins">Poppins</option>
                                        <option value="Raleway">Raleway</option>
                                        <option value="Work Sans">Work Sans</option>
                                    </optgroup>
                                </select>
                                
                                <select id="font-size" class="toolbar-select" title="Font Size">
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12" selected>12</option>
                                    <option value="14">14</option>
                                    <option value="16">16</option>
                                    <option value="18">18</option>
                                    <option value="20">20</option>
                                    <option value="22">22</option>
                                    <option value="24">24</option>
                                    <option value="26">26</option>
                                    <option value="28">28</option>
                                    <option value="36">36</option>
                                    <option value="48">48</option>
                                    <option value="72">72</option>
                                </select>
                                
                                <button class="toolbar-btn" data-command="bold" title="Bold (Ctrl+B)">
                                    <strong>B</strong>
                                </button>
                                
                                <button class="toolbar-btn" data-command="italic" title="Italic (Ctrl+I)">
                                    <em>I</em>
                                </button>
                                
                                <button class="toolbar-btn" data-command="underline" title="Underline (Ctrl+U)">
                                    <u>U</u>
                                </button>
                                
                                <button class="toolbar-btn" data-command="strikethrough" title="Strikethrough">
                                    <s>S</s>
                                </button>
                                
                                <button class="toolbar-btn" id="highlight-btn" title="Highlight">
                                    <span style="background: var(--highlight-color, #ffeb3b); padding: 2px 4px; font-weight: bold;">H</span>
                                </button>
                                
                                <input type="color" id="highlight-color" value="#ffeb3b" title="Highlight Color" class="color-input">
                                
                                <button class="toolbar-btn" id="text-color-btn" title="Text Color">
                                    <span class="color-indicator" style="background: var(--text-color, #000000);"></span>
                                </button>
                                
                                <input type="color" id="text-color" value="#000000" title="Text Color" class="color-input">
                            </div>
                            
                            <div class="toolbar-divider"></div>
                            
                            <!-- Paragraph Formatting Section -->
                            <div class="toolbar-section">
                                <button class="toolbar-btn" data-command="justifyLeft" title="Align Left">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="3" y1="6" x2="21" y2="6"/>
                                        <line x1="3" y1="12" x2="15" y2="12"/>
                                        <line x1="3" y1="18" x2="18" y2="18"/>
                                    </svg>
                                </button>
                                
                                <button class="toolbar-btn" data-command="justifyCenter" title="Center">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="3" y1="6" x2="21" y2="6"/>
                                        <line x1="6" y1="12" x2="18" y2="12"/>
                                        <line x1="3" y1="18" x2="21" y2="18"/>
                                    </svg>
                                </button>
                                
                                <button class="toolbar-btn" data-command="justifyRight" title="Align Right">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="3" y1="6" x2="21" y2="6"/>
                                        <line x1="9" y1="12" x2="21" y2="12"/>
                                        <line x1="6" y1="18" x2="21" y2="18"/>
                                    </svg>
                                </button>
                                
                                <button class="toolbar-btn" data-command="justifyFull" title="Justify">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="3" y1="6" x2="21" y2="6"/>
                                        <line x1="3" y1="12" x2="21" y2="12"/>
                                        <line x1="3" y1="18" x2="21" y2="18"/>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="toolbar-divider"></div>
                            
                            <!-- Lists and Indentation Section -->
                            <div class="toolbar-section">
                                <button class="toolbar-btn" data-command="insertUnorderedList" title="Bullet List">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="8" y1="6" x2="21" y2="6"/>
                                        <line x1="8" y1="12" x2="21" y2="12"/>
                                        <line x1="8" y1="18" x2="21" y2="18"/>
                                        <circle cx="4" cy="6" r="1" fill="currentColor"/>
                                        <circle cx="4" cy="12" r="1" fill="currentColor"/>
                                        <circle cx="4" cy="18" r="1" fill="currentColor"/>
                                    </svg>
                                </button>
                                
                                <button class="toolbar-btn" data-command="insertOrderedList" title="Numbered List">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="10" y1="6" x2="21" y2="6"/>
                                        <line x1="10" y1="12" x2="21" y2="12"/>
                                        <line x1="10" y1="18" x2="21" y2="18"/>
                                        <text x="3" y="8" font-size="8" fill="currentColor">1.</text>
                                        <text x="3" y="14" font-size="8" fill="currentColor">2.</text>
                                        <text x="3" y="20" font-size="8" fill="currentColor">3.</text>
                                    </svg>
                                </button>
                                
                                <button class="toolbar-btn" data-command="indent" title="Increase Indent">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3,8 7,12 3,16"/>
                                        <line x1="11" y1="4" x2="21" y2="4"/>
                                        <line x1="11" y1="12" x2="21" y2="12"/>
                                        <line x1="11" y1="20" x2="21" y2="20"/>
                                    </svg>
                                </button>
                                
                                <button class="toolbar-btn" data-command="outdent" title="Decrease Indent">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="7,8 3,12 7,16"/>
                                        <line x1="11" y1="4" x2="21" y2="4"/>
                                        <line x1="11" y1="12" x2="21" y2="12"/>
                                        <line x1="11" y1="20" x2="21" y2="20"/>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="toolbar-divider"></div>
                            
                            <!-- Insert Section -->
                            <div class="toolbar-section">
                                <button class="toolbar-btn" id="insert-link" title="Insert Link (Ctrl+K)">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                                    </svg>
                                </button>
                                
                                <button class="toolbar-btn" data-command="insertHorizontalRule" title="Insert Horizontal Line">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="3" y1="12" x2="21" y2="12"/>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="toolbar-divider"></div>
                            
                            <!-- Actions Section -->
                            <div class="toolbar-section">
                                <button class="toolbar-btn" data-command="undo" title="Undo (Ctrl+Z)">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 7v6h6M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3l-3 2.7"/>
                                    </svg>
                                </button>
                                
                                <button class="toolbar-btn" data-command="redo" title="Redo (Ctrl+Y)">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 7v6h-6M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"/>
                                    </svg>
                                </button>
                                
                                <button class="toolbar-btn" data-command="removeFormat" title="Clear Formatting">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 7V4h16v3"/>
                                        <path d="M5 20h6"/>
                                        <path d="M13 4L9 20"/>
                                        <line x1="18" y1="6" x2="6" y2="18" stroke-width="3"/>
                                    </svg>
                                </button>
                                
                                <button class="toolbar-btn" id="clear-all" title="Clear All">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3,6 5,6 21,6"/>
                                        <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6"/>
                                        <line x1="10" y1="11" x2="10" y2="17"/>
                                        <line x1="14" y1="11" x2="14" y2="17"/>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="toolbar-divider"></div>
                            
                            <!-- AI Section -->
                            <div class="toolbar-section">
                                <button class="toolbar-btn" id="generate-summary" title="Generate AI Summary">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                        <path d="M2 17l10 5 10-5"/>
                                        <path d="M2 12l10 5 10-5"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div id="notes-editor" class="notes-editor" data-testid="notes-editor" contenteditable="true" 
                             placeholder="Start typing your notes here..."></div>
                        <div id="ai-summary" class="ai-summary" style="display: none;">
                            <h3>AI Summary</h3>
                            <div class="ai-summary-content"></div>
                        </div>
                    </div>

                    <!-- Resize Handle -->
                    <div class="resize-handle" id="resize-handle" title="Drag to resize sections">
                        <div class="resize-handle-bar"></div>
                    </div>

                    <!-- Transcription Panel -->
                    <div class="transcription-section">
                        <div class="transcription-header">
                            <h2>Live Transcription</h2>
                            <div class="transcription-controls">
                                <button id="clear-transcription" class="btn btn-small" title="Clear all transcription text">Clear</button>
                                <button id="jump-latest" class="btn btn-small" title="Scroll to latest">Jump to Latest</button>
                            </div>
                        </div>
                        <div id="transcription-display" class="transcription-display" data-testid="transcription-display"></div>
                    </div>
                </div>

                <!-- AI Chat Window -->
                <!-- AI Chat Floating Button -->
                <div class="ai-chat-container" id="ai-chat-container">
                    <!-- Floating Claude Button -->
                    <button class="claude-fab" id="claude-fab" title="Ask Claude AI">
                        <img class="claude-icon" src="../../assets/images/AskAI-cat.PNG" alt="Ask AI" onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\'font-size: 24px;\'>ü§ñ</span>';">
                    </button>
                    
                    <!-- Expanded Chat Panel -->
                    <div class="ai-chat-panel" id="ai-chat-panel">
                        <div class="chat-header">
                            <div class="chat-title">
                                <img class="claude-icon-small" src="../../assets/images/AskAI-cat.PNG" alt="Ask AI" onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\'font-size: 18px;\'>ü§ñ</span><h3>Ask Claude</h3>';">
                                <h3>Ask Claude</h3>
                            </div>
                            <button class="chat-close" id="chat-close" title="Close chat">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <div class="chat-messages" id="chat-messages"></div>
                        <div class="chat-input-container">
                            <input type="text" id="chat-input" placeholder="Ask about your notes or transcription..." class="chat-input">
                            <button id="send-chat" class="btn btn-primary btn-small" title="Send message">Send</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Capture Mode -->

            <!-- Study Mode - Recording library and review interface -->
            <div class="study-mode" id="study-mode" data-testid="study-mode" style="display: none;">
                <!-- Recordings List View -->
                <div class="recordings-list-view" id="recordings-list-view" data-testid="recordings-list-view">
                    <div class="recordings-header">
                        <h2>Your Recordings</h2>
                        <div class="recordings-meta">
                            <span id="recordings-count">Loading...</span>
                        </div>
                    </div>
                    
                    <!-- Course Filter -->
                    <div class="course-filter-container">
                        <div class="course-filter-label">
                            <label for="study-course-filter">Filter by Course:</label>
                        </div>
                        <div class="course-filter-controls">
                            <select id="study-course-filter" class="input-field course-filter-select">
                                <option value="">All Courses</option>
                            </select>
                            <div class="active-filter-indicator" id="active-filter-indicator" style="display: none;">
                                <span class="filter-badge" id="filter-badge">Showing: All Courses</span>
                                <button class="clear-filter-btn" id="clear-filter-btn" title="Clear filter">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recordings-list" id="recordings-list" data-testid="recordings-list">
                        <!-- Recordings will be populated by JavaScript -->
                        <div class="recordings-loading" id="recordings-loading">
                            <div class="loading-spinner"></div>
                            <p>Loading recordings...</p>
                        </div>
                        <div class="recordings-empty" id="recordings-empty" style="display: none;">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M9 9l6 6"/>
                                <path d="M15 9l-6 6"/>
                            </svg>
                            <h3>No recordings yet</h3>
                            <p>Switch to Capture mode to start recording lectures</p>
                        </div>
                    </div>
                </div>

                <!-- Recording Review View -->
                <div class="recording-review-view" id="recording-review-view" style="display: none;">
                    <div class="review-header">
                        <button class="btn btn-secondary" id="back-to-list">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 12H6M12 5l-7 7 7 7"/>
                            </svg>
                            Back to List
                        </button>
                        <div class="review-title">
                            <h2 id="review-course-title">Course Title</h2>
                            <p id="review-session-info">Date and time</p>
                        </div>
                    </div>

                    <div class="review-controls">
                        <div class="audio-controls">
                            <button class="btn" id="review-play-pause">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="5,3 19,12 5,21"/>
                                </svg>
                                Play
                            </button>
                            <button class="btn" id="review-skip-back" title="Skip back 10 seconds">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 12H6M12 5l-7 7 7 7"/>
                                </svg>
                                10s
                            </button>
                            <button class="btn" id="review-skip-forward" title="Skip forward 30 seconds">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M5 12h13M12 5l7 7-7 7"/>
                                </svg>
                                30s
                            </button>
                            <div class="audio-time">
                                <span id="review-current-time">0:00</span>
                                <span>/</span>
                                <span id="review-total-time">0:00</span>
                            </div>
                        </div>
                        <div class="audio-seek-bar">
                            <input type="range" id="review-seek-bar" min="0" max="100" value="0" class="seek-slider">
                        </div>
                    </div>

                    <div class="review-content">
                        <div class="review-notes-section">
                            <h3>Notes</h3>
                            <div class="review-notes" id="review-notes">
                                <!-- Notes content will be loaded here -->
                            </div>
                        </div>
                        <div class="review-transcription-section">
                            <h3>Transcription</h3>
                            <div class="review-transcription" id="review-transcription">
                                <!-- Transcription content will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Study Mode -->
        </main>

        <!-- Version Info -->
        <div class="system-info-corner">
            <div class="health-indicator" id="health-indicator" title="System Health">
                <svg class="ekg-icon" width="48" height="48" viewBox="0 0 100 24" xmlns="http://www.w3.org/2000/svg">
                    <path class="ekg-line" d="M0,12 L20,12 L25,5 L30,20 L35,8 L40,16 L45,12 L100,12" 
                          fill="none" stroke="currentColor" stroke-width="4"/>
                </svg>
            </div>
            <div class="version-info" id="version-info">v1.0.0</div>
        </div>
        
        
        <!-- Health Status Dialog -->
        <div class="modal-overlay" id="health-dialog" style="display: none;">
            <div class="modal-content health-dialog-content">
                <div class="modal-header">
                    <h3>System Health Monitor</h3>
                    <button class="modal-close" id="health-dialog-close">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Bug Reporter Section -->
                    <div class="health-section bug-reporter-section">
                        <h4>Report Issues</h4>
                        <p class="section-description">Found a problem? Report it to help improve ScribeCat.</p>
                        <button id="health-report-bug" class="btn btn-primary">Report Bug</button>
                    </div>

                    <!-- Search/Filter Section -->
                    <div class="health-section search-section">
                        <div class="search-container">
                            <input type="text" id="health-search" placeholder="Search system components..." class="input-field">
                            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                            </svg>
                        </div>
                    </div>

                    <!-- Comprehensive Status List -->
                    <div class="health-section status-list-section">
                        <h4>System Components</h4>
                        <div class="health-status-list" id="health-status-list">
                            <!-- Status items will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Health Tooltip -->
        <div class="health-tooltip" id="health-tooltip" style="display: none;">
            <div class="tooltip-content">
                <div class="critical-status-list" id="critical-status-list">
                    <!-- Critical status items will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Clear Notes Confirmation Modal -->
        <div class="modal-overlay" id="clear-notes-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Clear All Notes</h3>
                    <button class="modal-close" id="clear-notes-modal-close">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to clear all notes? This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button id="clear-notes-cancel" class="btn btn-secondary">Cancel</button>
                    <button id="clear-notes-confirm" class="btn btn-danger">Clear All Notes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Options Dialog -->
    <div class="modal" id="export-options-modal" style="display: none;">
        <div class="modal-content export-options-modal">
            <div class="modal-header">
                <h3>Export Options</h3>
                <button class="modal-close" id="export-options-close">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p class="export-intro">Your session has been saved to Downloads. Choose additional export options:</p>
                
                <div class="export-section">
                    <h4>Cloud Storage Upload</h4>
                    <div class="export-options-grid">
                        <div class="export-option">
                            <button class="btn export-btn" id="export-google-drive" data-service="google-drive">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M7 14l5-5 5 5"/>
                                    <path d="M7 14l5-5 5 5"/>
                                </svg>
                                Upload to Google Drive
                            </button>
                            <span class="connection-status" id="drive-connection-status">Not Connected</span>
                        </div>
                        <div class="export-option">
                            <button class="btn export-btn" id="export-dropbox" data-service="dropbox">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M7 14l5-5 5 5"/>
                                    <path d="M7 14l5-5 5 5"/>
                                </svg>
                                Upload to Dropbox
                            </button>
                            <span class="connection-status" id="dropbox-connection-status">Not Connected</span>
                        </div>
                    </div>
                </div>
                
                <div class="export-section">
                    <h4>Additional Formats</h4>
                    <div class="export-options-grid">
                        <div class="export-option">
                            <button class="btn export-btn" id="export-pdf" data-format="pdf">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14,2 14,8 20,8"></polyline>
                                </svg>
                                Export as PDF
                            </button>
                        </div>
                        <div class="export-option">
                            <button class="btn export-btn" id="export-markdown" data-format="markdown">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14,2 14,8 20,8"></polyline>
                                </svg>
                                Export as Markdown
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="export-section setup-links">
                    <p class="setup-note">Need to set up connections? <a href="#" id="open-settings-link">Configure in Settings</a></p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="export-skip" class="btn btn-secondary">Skip</button>
                <button id="export-done" class="btn btn-primary">Done</button>
            </div>
        </div>
    </div>

    <!-- Course Import Modal -->
    <div class="modal-overlay" id="course-import-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Courses from Browser Extension</h3>
                <button class="modal-close" id="course-import-close">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="import-instructions">
                    <p>Paste the JSON data from the ScribeCat Canvas Course Collector browser extension:</p>
                    <ol>
                        <li>Open the browser extension on your Canvas dashboard</li>
                        <li>Click "Copy for ScribeCat" to copy the course data</li>
                        <li>Paste the data in the text area below</li>
                        <li>Click "Import Courses" to add them to ScribeCat</li>
                    </ol>
                </div>
                <div class="import-form">
                    <textarea id="course-import-data" placeholder="Paste JSON data from browser extension here..." rows="10"></textarea>
                    <div class="import-actions">
                        <button id="course-import-btn" class="btn btn-primary">Import Courses</button>
                        <button id="course-import-cancel" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
                <div id="course-import-results" class="import-results" style="display: none;">
                    <h4>Import Results</h4>
                    <div id="course-import-summary"></div>
                    <div id="course-import-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Management Modal -->
    <div class="modal-overlay" id="course-management-modal" style="display: none;">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3>Manage Courses</h3>
                <button class="modal-close" id="course-management-close">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="course-management-actions">
                    <button id="add-course-btn" class="btn btn-primary">Add New Course</button>
                    <button id="refresh-courses-btn" class="btn btn-secondary">Refresh List</button>
                </div>
                <div class="courses-list" id="courses-list">
                    <div class="courses-loading">Loading courses...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Notification Container -->
    <div id="error-notification-container" class="error-notification-container"></div>

    <script type="module" src="./app.ts"></script>
</body>
</html>
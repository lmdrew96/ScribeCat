<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScribeCat</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <!-- Empty space for native window controls -->
            </div>
            <div class="header-center">
                <div class="logo-container">
                    <img src="../../assets/images/nugget.png" alt="ScribeCat" class="logo" onerror="this.style.display='none'">
                    <h1 class="app-title">ScribeCat</h1>
                </div>
            </div>
            <div class="header-right">
                <div class="clock-section">
                    <div class="clock" id="clock">
                        <div class="time">12:00 PM</div>
                        <div class="date">Monday, Jan 1</div>
                    </div>
                    <div class="status-chips">
                        <div class="status-chip" id="audio-status" title="Audio Status - Click for details">
                            <div class="status-indicator"></div>
                            <span>Audio</span>
                        </div>
                        <div class="status-chip" id="transcription-status" title="Transcription Status - Click for details">
                            <div class="status-indicator"></div>
                            <span>AI</span>
                        </div>
                        <div class="status-chip" id="drive-status" title="Drive Status - Click for details">
                            <div class="status-indicator"></div>
                            <span>Drive</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>



        <!-- Error Notification Banner -->
        <div class="error-notification" id="error-notification" style="display: none;">
            <div class="notification-content">
                <div class="notification-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </div>
                <div class="notification-message">
                    <span id="error-notification-text">ScribeCat encountered an issue that may affect functionality</span>
                </div>
                <div class="notification-actions">
                    <button id="dismiss-error" class="btn-notification dismiss" title="Dismiss this notification">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                    <button id="report-error-bug" class="btn-notification primary">Report Bug</button>
                </div>
            </div>
        </div>

        <!-- Floating Sidebar -->
        <aside class="sidebar" id="sidebar">
            <button class="sidebar-close">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <div class="sidebar-section">
                <h3>Themes</h3>
                <div class="theme-grid-container">
                    <div class="theme-grid" id="theme-grid">
                        <!-- Theme options will be generated by JavaScript -->
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>Canvas Integration</h3>
                <div class="canvas-settings">
                    <input type="text" id="canvas-url" placeholder="Canvas URL" class="input-field">
                    <div class="course-selection">
                        <select id="course-select" class="input-field">
                            <option value="">Select Course</option>
                            <option value="other">Other (Manual Entry)</option>
                        </select>
                        <div id="manual-course-fields" class="manual-course-fields" style="display: none;">
                            <input type="text" id="course-number" placeholder="Course Number" class="input-field">
                            <input type="text" id="course-title" placeholder="Course Title" class="input-field">
                        </div>
                    </div>
                    <div class="canvas-buttons">
                        <button id="save-canvas" class="btn btn-small">Save</button>
                        <button id="manage-courses" class="btn btn-small">Manage Courses</button>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>Google Drive</h3>
                <div class="drive-setup-info" style="margin-bottom: 12px;">
                    <p style="font-size: 12px; color: #666; margin: 0 0 8px 0;">
                        Need Google Drive for Desktop? 
                        <a href="#" id="drive-download-link" style="color: #1a73e8;">Download here</a>
                    </p>
                </div>
                <div class="drive-settings">
                    <div class="drive-folder-setting" style="margin-bottom: 12px;">
                        <label style="font-weight: bold; margin-bottom: 4px; display: block;">Notes Folder:</label>
                        <input type="text" id="notes-drive-folder" placeholder="Select Drive folder for notes" class="input-field" readonly>
                        <button id="select-notes-drive-folder" class="btn btn-small">Select Folder</button>
                    </div>
                    <div class="drive-folder-setting">
                        <label style="font-weight: bold; margin-bottom: 4px; display: block;">Transcription Folder:</label>
                        <input type="text" id="transcription-drive-folder" placeholder="Select Drive folder for transcriptions" class="input-field" readonly>
                        <button id="select-transcription-drive-folder" class="btn btn-small">Select Folder</button>

                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>Audio Settings</h3>
                <div class="audio-settings">
                    <div class="audio-destination" style="margin-bottom: 16px;">
                        <label style="font-weight: bold; margin-bottom: 8px; display: block;">Audio File Destination:</label>
                        <div style="margin-bottom: 8px;">
                            <label style="display: flex; align-items: center; margin-bottom: 4px;">
                                <input type="radio" name="audio-destination" value="local" id="audio-dest-local" style="margin-right: 8px;">
                                <span>Download to Local Folder</span>
                            </label>
                            <label style="display: flex; align-items: center;">
                                <input type="radio" name="audio-destination" value="drive" id="audio-dest-drive" style="margin-right: 8px;">
                                <span>Upload to Google Drive</span>
                            </label>
                        </div>
                    </div>
                    <div class="local-folder-settings" style="margin-bottom: 12px;">
                        <label>Local Audio Folder:</label>
                        <input type="text" id="local-audio-folder" placeholder="Select local folder for audio files" class="input-field" readonly>
                        <button id="select-local-audio-folder" class="btn btn-small">Select Folder</button>
                    </div>
                    <label>
                        <input type="checkbox" id="vocal-isolation"> Vocal Isolation
                    </label>
                    <select id="microphone-select" class="input-field">
                        <option value="">Select Microphone</option>
                    </select>
                    <div style="margin-top:12px">
                        <label for="transcription-backend">Transcription Backend:</label>
                        <select id="transcription-backend" class="input-field">
                            <option value="vosk">Vosk (Offline)</option>
                            <option value="whisper">Whisper (Optional)</option>
                        </select>

                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>Developer Settings</h3>
                <div class="developer-settings">
                    <div class="setting-item">
                        <div class="setting-header">
                            <label for="simulation-mode-toggle" class="setting-label">Simulation Mode</label>
                            <div class="toggle-container">
                                <div class="info-tooltip" title="When enabled, uses simulated responses for testing. When disabled, connects to real APIs and services.">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M12 16v-4"></path>
                                        <path d="M12 8h.01"></path>
                                    </svg>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="simulation-mode-toggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <p class="setting-disclaimer">
                            Disabling simulation mode will attempt to use real APIs and third-party services. This may cause unexpected behavior or errors if the required API keys or services are not properly configured.
                        </p>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>Claude API</h3>
                <div class="claude-settings">
                    <p style="font-size:12px;color:#666;margin-bottom:8px;">
                        Using developer key by default. Optionally provide your own key for guaranteed access.
                    </p>
                    <input type="text" id="claude-key" placeholder="Your Claude API Key (optional)" class="input-field">
                    <button id="save-claude-key" class="btn btn-small">Save Your Key</button>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content" id="main-content">
                <!-- Recording Controls -->
                <div class="recording-controls">
                    <button id="record-btn" class="btn btn-primary record-btn" title="Start recording audio and transcription">
                        <svg class="record-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                        Start Recording
                    </button>
                    <div class="recording-time" id="recording-time">00:00</div>
                    
                    <!-- VU Meter -->
                    <div class="vu-meter" id="vu-meter" style="display: none;">
                        <label>Audio Level:</label>
                        <div class="vu-bar-container">
                            <div class="vu-bar" id="vu-bar"></div>
                        </div>
                    </div>
                    
                    <button id="pause-btn" class="btn" disabled title="Pause current recording">Pause</button>
                    <button id="resume-btn" class="btn" disabled title="Resume paused recording">Resume</button>
                    <button id="stop-btn" class="btn btn-danger" disabled title="Stop recording and enable save">Stop</button>
                    <button id="save-btn" class="btn btn-success" disabled title="Save recording, notes, and transcription">Save</button>
                </div>

                <!-- Content Container -->
                <div class="content-container">
                    <!-- Notes Editor -->
                    <div class="editor-section">
                        <div class="editor-header">
                            <h2>Notes</h2>
                        </div>
                        <div class="formatting-toolbar">
                            <select id="font-family" class="font-selector" title="Change font family for notes editor">
                                <optgroup label="Traditional Serif">
                                    <option value="Times New Roman">Times New Roman</option>
                                    <option value="Georgia">Georgia</option>
                                    <option value="Garamond">Garamond</option>
                                    <option value="Book Antiqua">Book Antiqua</option>
                                    <option value="Palatino">Palatino</option>
                                </optgroup>
                                <optgroup label="Non-Traditional Serif">
                                    <option value="Playfair Display">Playfair Display</option>
                                    <option value="Crimson Text">Crimson Text</option>
                                    <option value="Libre Baskerville">Libre Baskerville</option>
                                    <option value="Merriweather">Merriweather</option>
                                    <option value="Vollkorn">Vollkorn</option>
                                </optgroup>
                                <optgroup label="Traditional Sans Serif">
                                    <option value="Arial">Arial</option>
                                    <option value="Helvetica">Helvetica</option>
                                    <option value="Calibri">Calibri</option>
                                    <option value="Tahoma">Tahoma</option>
                                    <option value="Verdana">Verdana</option>
                                    <option value="Geneva">Geneva</option>
                                    <option value="Lucida Sans">Lucida Sans</option>
                                    <option value="Trebuchet MS">Trebuchet MS</option>
                                    <option value="Century Gothic">Century Gothic</option>
                                    <option value="Franklin Gothic">Franklin Gothic</option>
                                </optgroup>
                                <optgroup label="Non-Traditional Sans Serif">
                                    <option value="Inter" selected>Inter</option>
                                    <option value="Roboto">Roboto</option>
                                    <option value="Open Sans">Open Sans</option>
                                    <option value="Lato">Lato</option>
                                    <option value="Montserrat">Montserrat</option>
                                    <option value="Source Sans Pro">Source Sans Pro</option>
                                    <option value="Nunito">Nunito</option>
                                    <option value="Poppins">Poppins</option>
                                    <option value="Raleway">Raleway</option>
                                    <option value="Work Sans">Work Sans</option>
                                </optgroup>
                            </select>
                            <div class="toolbar-separator"></div>
                            <button class="format-btn" data-command="undo" title="Undo (Ctrl+Z)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 7v6h6M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3l-3 2.7"/>
                                </svg>
                            </button>
                            <button class="format-btn" data-command="redo" title="Redo (Ctrl+Y)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 7v6h-6M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"/>
                                </svg>
                            </button>
                            <div class="toolbar-separator"></div>
                            <button class="format-btn" data-command="bold" title="Bold (Ctrl+B)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6zM6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z"/>
                                </svg>
                            </button>
                            <button class="format-btn" data-command="italic" title="Italic (Ctrl+I)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="19" y1="4" x2="10" y2="4"/>
                                    <line x1="14" y1="20" x2="5" y2="20"/>
                                    <line x1="15" y1="4" x2="9" y2="20"/>
                                </svg>
                            </button>
                            <button class="format-btn" data-command="underline" title="Underline (Ctrl+U)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 3v7a6 6 0 006 6 6 6 0 006-6V3"/>
                                    <line x1="4" y1="21" x2="20" y2="21"/>
                                </svg>
                            </button>
                            <button class="format-btn" data-command="strikethrough" title="Strikethrough">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M16 4H9a3 3 0 00-2.83 4"/>
                                    <path d="M14 12a4 4 0 01-0 8H6"/>
                                    <line x1="4" y1="12" x2="20" y2="12"/>
                                </svg>
                            </button>
                            <div class="toolbar-separator"></div>
                            <div class="color-selector-group">
                                <input type="color" id="font-color" class="color-selector" value="#000000" title="Font Color">
                                <label for="font-color" class="format-btn color-btn" title="Font Color">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 7V4h16v3"/>
                                        <path d="M9 20h6"/>
                                        <path d="M12 4l-3 16"/>
                                    </svg>
                                </label>
                            </div>
                            <div class="color-selector-group">
                                <input type="color" id="highlight-color" class="color-selector" value="#ffd200" title="Highlight Color">
                                <button class="format-btn" data-command="highlight" title="Highlight text (current: Yellow)">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <!-- Highlighter body -->
                                        <rect x="3" y="4" width="3" height="16" rx="1.5" fill="currentColor" opacity="0.8"/>
                                        <!-- Highlighter tip -->
                                        <rect x="6" y="8" width="2" height="8" rx="1" fill="var(--highlight-color, #ffd200)" stroke="currentColor" stroke-width="0.5"/>
                                        <!-- Highlighter cap -->
                                        <rect x="2.5" y="3" width="4" height="2" rx="1" fill="currentColor"/>
                                        <!-- Highlight mark effect -->
                                        <rect x="9" y="14" width="12" height="3" rx="1.5" fill="var(--highlight-color, #ffd200)" opacity="0.6"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="toolbar-separator"></div>
                            <button class="format-btn" data-command="justifyLeft" title="Align Left">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <line x1="3" y1="12" x2="15" y2="12"/>
                                    <line x1="3" y1="18" x2="18" y2="18"/>
                                </svg>
                            </button>
                            <button class="format-btn" data-command="justifyCenter" title="Align Center">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <line x1="6" y1="12" x2="18" y2="12"/>
                                    <line x1="3" y1="18" x2="21" y2="18"/>
                                </svg>
                            </button>
                            <button class="format-btn" data-command="justifyRight" title="Align Right">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="3" y1="6" x2="21" y2="6"/>
                                    <line x1="9" y1="12" x2="21" y2="12"/>
                                    <line x1="6" y1="18" x2="21" y2="18"/>
                                </svg>
                            </button>
                            <div class="toolbar-separator"></div>
                            <button class="format-btn" data-command="insertUnorderedList" title="Bullet List">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="8" y1="6" x2="21" y2="6"/>
                                    <line x1="8" y1="12" x2="21" y2="12"/>
                                    <line x1="8" y1="18" x2="21" y2="18"/>
                                    <line x1="3" y1="6" x2="3.01" y2="6"/>
                                    <line x1="3" y1="12" x2="3.01" y2="12"/>
                                    <line x1="3" y1="18" x2="3.01" y2="18"/>
                                </svg>
                            </button>
                            <button class="format-btn" data-command="insertOrderedList" title="Numbered List">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="10" y1="6" x2="21" y2="6"/>
                                    <line x1="10" y1="12" x2="21" y2="12"/>
                                    <line x1="10" y1="18" x2="21" y2="18"/>
                                    <path d="M4 6h1v4"/>
                                    <path d="M4 10h2"/>
                                    <path d="M6 18H4c0-1 2-2 2-3s-1-1.5-1-1"/>
                                </svg>
                            </button>
                            <button class="format-btn" data-command="indent" title="Indent">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3,8 7,12 3,16"/>
                                    <line x1="21" y1="4" x2="11" y2="4"/>
                                    <line x1="21" y1="12" x2="11" y2="12"/>
                                    <line x1="21" y1="20" x2="11" y2="20"/>
                                </svg>
                            </button>
                            <button class="format-btn" data-command="outdent" title="Outdent">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="7,8 3,12 7,16"/>
                                    <line x1="21" y1="4" x2="11" y2="4"/>
                                    <line x1="21" y1="12" x2="11" y2="12"/>
                                    <line x1="21" y1="20" x2="11" y2="20"/>
                                </svg>
                            </button>
                            <div class="toolbar-separator"></div>
                            <button class="format-btn" data-shortcut="dash" title="Insert Dash">—</button>
                            <button class="format-btn" data-shortcut="arrow" title="Insert Arrow">→</button>
                            <div class="toolbar-separator"></div>
                            <button id="clear-notes" class="format-btn clear-notes-btn" title="Clear all notes (Ctrl+Shift+Delete)">
                                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3,6 5,6 21,6"></polyline>
                                    <path d="M19,6v14a2,2 0,0,1-2,2H7a2,2,0,0,1-2-2V6M8,6V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                                Clear All
                            </button>
                        </div>
                        <div id="notes-editor" class="notes-editor" contenteditable="true" 
                             placeholder="Start typing your notes here..."></div>
                        <div id="ai-summary-container" style="margin-top:24px;">
                            <button id="generate-summary" class="btn btn-primary" style="width:100%;margin-bottom:12px;" title="Generate AI summary of notes and transcription">Generate AI Summary</button>
                            <div id="ai-summary" class="notes-editor" style="min-height:80px;background:#f8fafc;border:1px solid #e2e8f0;"></div>
                        </div>
                    </div>

                    <!-- Resize Handle -->
                    <div class="resize-handle" id="resize-handle" title="Drag to resize sections">
                        <div class="resize-handle-bar"></div>
                    </div>

                    <!-- Transcription Panel -->
                    <div class="transcription-section">
                        <div class="transcription-header">
                            <h2>Live Transcription</h2>
                            <div class="transcription-controls">
                                <button id="clear-transcription" class="btn btn-small" title="Clear all transcription text">Clear</button>
                                <button id="jump-latest" class="btn btn-small" title="Scroll to latest">Jump to Latest</button>
                            </div>
                        </div>
                        <div id="transcription-display" class="transcription-display"></div>
                    </div>
                </div>

                <!-- AI Chat Window -->
                <!-- AI Chat Floating Button -->
                <div class="ai-chat-container" id="ai-chat-container">
                    <!-- Floating Claude Button -->
                    <button class="claude-fab" id="claude-fab" title="Ask Claude AI">
                        <img class="claude-icon" src="../../assets/images/AskAI-logo.jpeg" alt="Ask AI" onerror="this.style.display='none'">
                    </button>
                    
                    <!-- Expanded Chat Panel -->
                    <div class="ai-chat-panel" id="ai-chat-panel">
                        <div class="chat-header">
                            <div class="chat-title">
                                <img class="claude-icon-small" src="../../assets/images/AskAI-logo.jpeg" alt="Ask AI">
                                <h3>Ask Claude</h3>
                            </div>
                            <button class="chat-close" id="chat-close" title="Close chat">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <div class="chat-messages" id="chat-messages"></div>
                        <div class="chat-input-container">
                            <input type="text" id="chat-input" placeholder="Ask about your notes or transcription..." class="chat-input">
                            <button id="send-chat" class="btn btn-primary btn-small" title="Send message">Send</button>
                        </div>
                    </div>
                </div>
            </main>

        <!-- Version Info -->
        <div class="version-info" id="version-info">v1.0.0</div>
        
        <!-- Sidebar Scrim -->
        <div class="sidebar-scrim" id="sidebar-scrim"></div>
        
        <!-- Clear Notes Confirmation Modal -->
        <div class="modal-overlay" id="clear-notes-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Clear All Notes</h3>
                    <button class="modal-close" id="clear-notes-modal-close">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to clear all notes? This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button id="clear-notes-cancel" class="btn btn-secondary">Cancel</button>
                    <button id="clear-notes-confirm" class="btn btn-danger">Clear All Notes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScribeCat Canvas Integration</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="popup-container">
        <!-- Header -->
        <header class="popup-header">
            <div class="logo-section">
                <img src="../icons/icon48.png" alt="ScribeCat" class="logo" onerror="this.style.display='none'">
                <div class="title-section">
                    <h1>ScribeCat</h1>
                    <p class="subtitle">Canvas Integration</p>
                </div>
            </div>
        </header>

        <!-- Status Section -->
        <section class="status-section">
            <div class="status-indicator" id="status-indicator">
                <span class="status-dot" id="status-dot"></span>
                <span class="status-text" id="status-text">Checking Canvas...</span>
            </div>
            <div class="canvas-url" id="canvas-url">Not on Canvas</div>
        </section>

        <!-- Action Buttons -->
        <section class="action-section">
            <button id="scrape-btn" class="btn btn-primary" disabled>
                <span class="btn-icon">üîç</span>
                Scrape Courses
            </button>
            <button id="refresh-btn" class="btn btn-secondary">
                <span class="btn-icon">üîÑ</span>
                Refresh
            </button>
        </section>

        <!-- Course List -->
        <section class="course-section">
            <div class="section-header">
                <h3>Found Courses</h3>
                <span class="course-count" id="course-count">0</span>
            </div>
            <div class="course-list" id="course-list">
                <div class="empty-state" id="empty-state">
                    <p>No courses found yet.</p>
                    <p class="help-text">Navigate to your Canvas dashboard and click "Scrape Courses".</p>
                </div>
            </div>
        </section>

        <!-- Export Section -->
        <section class="export-section" id="export-section" style="display: none;">
            <h3>Export Options</h3>
            <div class="export-buttons">
                <button id="export-json" class="btn btn-export" title="Export as JSON for manual import">
                    <span class="btn-icon">üìÑ</span>
                    JSON
                </button>
                <button id="export-csv" class="btn btn-export" title="Export as CSV spreadsheet">
                    <span class="btn-icon">üìä</span>
                    CSV
                </button>
                <button id="export-scribecat" class="btn btn-export btn-primary" title="Export for direct ScribeCat import">
                    <span class="btn-icon">üê±</span>
                    ScribeCat
                </button>
            </div>
            <div class="export-help">
                <p class="help-text">
                    üìÅ Files are downloaded to your default download folder.
                    <br>
                    üê± Use ScribeCat format for direct import into the desktop app.
                </p>
            </div>
        </section>

        <!-- Settings Section -->
        <section class="settings-section">
            <details>
                <summary>Settings & Advanced</summary>
                <div class="settings-content">
                    <label class="checkbox-label">
                        <input type="checkbox" id="auto-scrape" checked>
                        <span class="checkmark"></span>
                        Auto-scrape when on Canvas dashboard
                    </label>
                    
                    <label class="checkbox-label">
                        <input type="checkbox" id="debug-mode">
                        <span class="checkmark"></span>
                        Enable debug mode (console logs)
                    </label>
                    
                    <div class="advanced-actions">
                        <button id="clear-data" class="btn btn-danger btn-small">
                            Clear Stored Data
                        </button>
                        <button id="test-connection" class="btn btn-secondary btn-small">
                            Test ScribeCat Connection
                        </button>
                    </div>
                </div>
            </details>
        </section>

        <!-- Footer -->
        <footer class="popup-footer">
            <div class="last-update" id="last-update">
                Never scraped
            </div>
            <div class="links">
                <a href="#" id="help-link">Help</a>
                <span>‚Ä¢</span>
                <a href="#" id="privacy-link">Privacy</a>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <div class="modal" id="help-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>How to Use</h3>
                <button class="modal-close" id="help-close">&times;</button>
            </div>
            <div class="modal-body">
                <ol>
                    <li><strong>Navigate to Canvas:</strong> Go to your institution's Canvas dashboard</li>
                    <li><strong>Open Extension:</strong> Click the ScribeCat extension icon</li>
                    <li><strong>Scrape Courses:</strong> Click "Scrape Courses" to collect course data</li>
                    <li><strong>Export Data:</strong> Choose export format (JSON/CSV/ScribeCat)</li>
                    <li><strong>Import to ScribeCat:</strong> Use the exported file in ScribeCat desktop app</li>
                </ol>
                <h4>Supported Canvas URLs:</h4>
                <ul>
                    <li>*.instructure.com (most institutions)</li>
                    <li>*.canvas.com (some custom domains)</li>
                </ul>
                <h4>Troubleshooting:</h4>
                <ul>
                    <li>Ensure you're logged into Canvas</li>
                    <li>Try refreshing the Canvas page</li>
                    <li>Enable debug mode for console logs</li>
                    <li>Different Canvas themes may require multiple scrape attempts</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="modal" id="privacy-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Privacy Policy</h3>
                <button class="modal-close" id="privacy-close">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Data Collection:</h4>
                <ul>
                    <li>Only collects course numbers and titles from Canvas</li>
                    <li>Does not access personal information, grades, or student data</li>
                    <li>No data is sent to external servers</li>
                </ul>
                <h4>Data Storage:</h4>
                <ul>
                    <li>Course data stored locally in browser extension storage</li>
                    <li>Data is only accessible to this extension</li>
                    <li>Can be cleared at any time using "Clear Stored Data"</li>
                </ul>
                <h4>Permissions:</h4>
                <ul>
                    <li><strong>activeTab:</strong> Access current Canvas tab for scraping</li>
                    <li><strong>storage:</strong> Store scraped course data locally</li>
                    <li><strong>host_permissions:</strong> Access Canvas domains only</li>
                </ul>
                <p><strong>No personal data is collected, stored, or transmitted.</strong></p>
            </div>
        </div>
    </div>

    <script src="popup.js"></script>
</body>
</html>